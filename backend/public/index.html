<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>E-Commerce Website</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <!-- Include your full HTML content as in your previous message here -->

  <!-- Just below everything, include this script to hook up forms -->
  <script>
    const base = 'https://ecommers-ula5.onrender.com/api';
    let selectedProduct = null;

    function showSection(id) {
      document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    function buyNow(product) {
      selectedProduct = product;
      showSection('address');
    }

    const handleSubmit = (formId, endpoint, successCallback) => {
      const form = document.getElementById(formId);
      form.addEventListener('submit', async e => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        try {
          const res = await fetch(`${base}/${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const result = await res.json();
          if (result.success) {
            alert(`${endpoint} submitted successfully!`);
            form.reset();
            if (successCallback) successCallback();
          } else {
            alert('Error: ' + (result.error || 'Unknown'));
          }
        } catch (err) {
          alert('Request failed: ' + err.message);
        }
      });
    };

    handleSubmit('registerForm', 'register', () => showSection('home'));
    handleSubmit('addressForm', 'address', () => showSection('billing'));
    handleSubmit('billingForm', 'billing', () => showSection('home'));
    handleSubmit('contactForm', 'contact', () => showSection('home'));

    async function loadSubmittedData() {
      try {
        const res = await fetch(`${base}/get-register`);
        const data = await res.json();
        const table = document.getElementById('dataTable');
        const tbody = document.getElementById('dataBody');
        const noData = document.getElementById('noData');
        tbody.innerHTML = '';
        if (Array.isArray(data) && data.length) {
          table.classList.remove('hidden');
          noData.classList.add('hidden');
          data.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td class="border p-2">${row[0] || ''}</td>
              <td class="border p-2">${row[1] || ''}</td>
              <td class="border p-2">${row[2] || ''}</td>
              <td class="border p-2">${row[3] || ''}</td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          table.classList.add('hidden');
          noData.classList.remove('hidden');
        }
      } catch (err) {
        alert('Error loading data: ' + err.message);
      }
    }

    showSection('home');
  </script>
</body>
</html>
